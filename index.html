<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>美味面馆点餐系统</title>
    <script src="https://cdn.goeasy.io/goeasy-2.2.7.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #ff7e5f, #feb47b);
            border-radius: 10px;
            color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .menu {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .dish-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .dish-card:hover {
            transform: translateY(-5px);
        }
        
        .dish-name {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        
        .dish-price {
            color: #e74c3c;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .quantity-control {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .quantity-btn {
            background: #f0f0f0;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .quantity-btn:hover {
            background: #ddd;
        }
        
        .quantity {
            font-size: 1.2rem;
            font-weight: bold;
            margin: 0 10px;
        }
        
        .order-summary {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .order-items {
            margin-bottom: 15px;
        }
        
        .order-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px dashed #eee;
        }
        
        .total {
            display: flex;
            justify-content: space-between;
            font-size: 1.2rem;
            font-weight: bold;
            padding-top: 10px;
            border-top: 2px solid #eee;
        }
        
        .submit-btn {
            display: block;
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
        }
        
        .submit-btn:active {
            transform: translateY(0);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: #4CAF50;
            color: white;
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        @media (max-width: 600px) {
            .menu {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>美味面馆</h1>
        <p>欢迎光临，请点餐！</p>
    </header>
    
    <div class="menu">
        <div class="dish-card">
            <div class="dish-name">雪菜肉丝面</div>
            <div class="dish-price">11元</div>
            <div class="quantity-control">
                <button class="quantity-btn" onclick="updateQuantity('noodle1', -1)">-</button>
                <span class="quantity" id="noodle1-quantity">0</span>
                <button class="quantity-btn" onclick="updateQuantity('noodle1', 1)">+</button>
            </div>
        </div>
        
        <div class="dish-card">
            <div class="dish-name">六鲜皮肚面</div>
            <div class="dish-price">12元</div>
            <div class="quantity-control">
                <button class="quantity-btn" onclick="updateQuantity('noodle2', -1)">-</button>
                <span class="quantity" id="noodle2-quantity">0</span>
                <button class="quantity-btn" onclick="updateQuantity('noodle2', 1)">+</button>
            </div>
        </div>
        
        <div class="dish-card">
            <div class="dish-name">葱油拌面</div>
            <div class="dish-price">8.8元</div>
            <div class="quantity-control">
                <button class="quantity-btn" onclick="updateQuantity('noodle3', -1)">-</button>
                <span class="quantity" id="noodle3-quantity">0</span>
                <button class="quantity-btn" onclick="updateQuantity('noodle3', 1)">+</button>
            </div>
        </div>
        
        <div class="dish-card">
            <div class="dish-name">南昌拌粉</div>
            <div class="dish-price">8.8元</div>
            <div class="quantity-control">
                <button class="quantity-btn" onclick="updateQuantity('noodle4', -1)">-</button>
                <span class="quantity" id="noodle4-quantity">0</span>
                <button class="quantity-btn" onclick="updateQuantity('noodle4', 1)">+</button>
            </div>
        </div>
        
        <div class="dish-card">
            <div class="dish-name">煎蛋</div>
            <div class="dish-price">2元</div>
            <div class="quantity-control">
                <button class="quantity-btn" onclick="updateQuantity('egg', -1)">-</button>
                <span class="quantity" id="egg-quantity">0</span>
                <button class="quantity-btn" onclick="updateQuantity('egg', 1)">+</button>
            </div>
        </div>
    </div>
    
    <div class="order-summary">
        <h2>订单详情</h2>
        <div class="order-items" id="order-items">
            <div class="order-item">暂无菜品选择</div>
        </div>
        <div class="total">
            <span>总计:</span>
            <span id="total-amount">0元</span>
        </div>
    </div>
    
    <button class="submit-btn" onclick="submitOrder()">提交订单</button>
    
    <div class="notification" id="notification">
        订单提交成功！
    </div>
    
    <script>
        // 菜品数据
        const dishes = {
            'noodle1': { name: '雪菜肉丝面', price: 11 },
            'noodle2': { name: '六鲜皮肚面', price: 12 },
            'noodle3': { name: '葱油拌面', price: 8.8 },
            'noodle4': { name: '南昌拌粉', price: 8.8 },
            'egg': { name: '煎蛋', price: 2 }
        };
        
        // 当前订单
        let order = {
            noodle1: 0,
            noodle2: 0,
            noodle3: 0,
            noodle4: 0,
            egg: 0
        };
        
        // 初始化GoEasy
        const goEasy = new GoEasy({
            host: 'hangzhou.goeasy.io', // 如果您在杭州区域
            appkey: 'BC-2b1a4a42874c4a32a7df65ac967bc145', // 您的Common Key
            onConnected: function() {
                console.log('GoEasy连接成功');
            },
            onDisconnected: function() {
                console.log('GoEasy连接断开');
            },
            onConnectFailed: function(error) {
                console.log('GoEasy连接失败:', error);
            }
        });
        
        // 更新菜品数量
        function updateQuantity(dishId, change) {
            const newQuantity = order[dishId] + change;
            if (newQuantity >= 0) {
                order[dishId] = newQuantity;
                document.getElementById(`${dishId}-quantity`).textContent = newQuantity;
                updateOrderSummary();
            }
        }
        
        // 更新订单摘要
        function updateOrderSummary() {
            const orderItems = document.getElementById('order-items');
            let totalAmount = 0;
            let hasItems = false;
            
            let orderHTML = '';
            for (const [dishId, quantity] of Object.entries(order)) {
                if (quantity > 0) {
                    hasItems = true;
                    const dish = dishes[dishId];
                    const itemTotal = dish.price * quantity;
                    totalAmount += itemTotal;
                    
                    orderHTML += `
                        <div class="order-item">
                            <span>${dish.name} x${quantity}</span>
                            <span>${itemTotal.toFixed(2)}元</span>
                        </div>
                    `;
                }
            }
            
            if (!hasItems) {
                orderHTML = '<div class="order-item">暂无菜品选择</div>';
            }
            
            orderItems.innerHTML = orderHTML;
            document.getElementById('total-amount').textContent = `${totalAmount.toFixed(2)}元`;
        }
        
        // 提交订单
        function submitOrder() {
            // 检查是否有菜品被选择
            const hasItems = Object.values(order).some(quantity => quantity > 0);
            if (!hasItems) {
                alert('请至少选择一份菜品');
                return;
            }
            
            // 构建订单数据
            const orderData = {
                items: [],
                total: 0,
                timestamp: new Date().toLocaleString('zh-CN')
            };
            
            for (const [dishId, quantity] of Object.entries(order)) {
                if (quantity > 0) {
                    const dish = dishes[dishId];
                    orderData.items.push({
                        name: dish.name,
                        quantity: quantity,
                        price: dish.price,
                        subtotal: dish.price * quantity
                    });
                    orderData.total += dish.price * quantity;
                }
            }
            
            // 发送订单到GoEasy
            goEasy.publish({
                channel: 'restaurant_orders',
                message: JSON.stringify(orderData),
                onSuccess: function() {
                    // 显示成功通知
                    const notification = document.getElementById('notification');
                    notification.textContent = '订单提交成功！';
                    notification.classList.add('show');
                    
                    // 3秒后隐藏通知
                    setTimeout(() => {
                        notification.classList.remove('show');
                    }, 3000);
                    
                    // 重置订单
                    for (const dishId in order) {
                        order[dishId] = 0;
                        document.getElementById(`${dishId}-quantity`).textContent = '0';
                    }
                    updateOrderSummary();
                },
                onFailed: function(error) {
                    alert('订单提交失败，请重试: ' + error.content);
                }
            });
        }
        
        // 初始化页面
        updateOrderSummary();
    </script>
</body>
</html>